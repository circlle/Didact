{"version":3,"sources":["../../src/createElement.ts","../../src/fiberMeta.ts","../../src/createDOM.ts","../../src/concurrent.ts","../../src/render.ts","../../src/index.ts","index.js"],"names":["Didact","render","document","getElementById","setTimeout"],"mappings":";;AMAA;;;sMLWA;AIXA,ACEAA,IDFA,WCEOC,IDFP,ECEA,CDFA,ACGE,ODHF,CAAA,iBAAA,CAAA,gBCII,wCACE,+CADF,CADF,CADF,EAMEC,QAAQ,CAACC,cAAT,CAAwB,MAAxB,CANF;AJDA,ADWA,AGXA,IFAA,ADWI,AGXJ,WAAA,CHWgB,EGXhB,CFAA,ADWiC,GCXjC,CDWA,EACA,AGZA,CAAA,GFAA,CAAA,SEAA,CAAA,OFAA,CAAA;AGAA,ACUAC,IDVA,MCUU,CACR,CDXF,GAAA,OAAA,CAAA,ACWQ,UDXR,CAAA;AHEA,ADWA,AGZA,AEWIJ,IJVE,ADWF,AGZJ,OHYW,GCXK,ADWY,CGZ5B,EFCmB,AIURC,CLCX,AGZA,KEWI,CACE,CFZN,CFCM,AEDN,UFCmB,CAAC,EEDpB,CFCmB,AEDnB,EFC+B,wBIYvB,wCACE,+CADF,CADF,EAIE,0CAJF,CADF,EAOEC,QAAQ,CAACC,cAAT,CAAwB,MAAxB,CAPF;AJVgC,ADYpC,AIZA,ACmBG,CAXO,EAYR,CLRE,AIZE,KHA8B,CGAxB,ACoBH,CAZC,CJR6B,AIQvC,CDRe,EJYA,ECZ6B,CDYZ,IAAhC,KCZoC,IAAsB,CAAC,OAAO,CAAC,GAAD,CAA9B;AAAmC,ADavE,AIZE,ADDF,CFAA,CGCE,EJYE,AGbJ,SHaa,EIZE,CJYU,AGbzB,CCCe,CJYf,CGbA,OAAA,CAAA,KCCe,CAAA,QDDf,CAAA,ICAe;AAEb,EAAA,MAAM,EAAA,QAAA,CAAA;AHDR,ADcO,AIfQ,ADGf,CCHA,GHCM,ADcO,AGZP,KFFK,CEEC,EFFE,CEES,GHYE,GAAG,ECdtB,CEEA,IFFQ,CAAC,CDcF,AGZU,CAAC,EFFV,EAA4B,GEEnB,CFFT,CEEmB,CFFkC,CDcvC,CAAC,MAAD,CGZL,CHYqB,CGZD;AFF6B,ADetE,AIXF,ADDE,EHYA,IGZM,CCCR,CAAA,CHJwE,EDe7D,EGZI,CHYD,CIXd,CDDyB,ECCV,CHJ0D,CDevE,ECfsE,EAAY,AGIpF;AHJyF,ADgBxF,AGZG,CHUG,GGVH,GAAG,EAAE,EFJgF,IAAI,CAAC,GAAD,AEGpE,CFHgE,KAAc,IAAI,CAAC,GAAD,CAAlB;AAAuB,AEK5G,GFLoE,CEKpE,MAAM,EAAE,IAFa;AFHuF,ADcnG,AGRT,CFNJ,GEMI,GHQS,CAAA,CGRJ,EAAE,IAHc,KHWZ,GAAY,YAAZ;AGPT,IAAA,OAAO,EAAE,IAJY;AFFzB,ADgBO,AGTH,IFPE,ADgBO,AGTT,IAAI,EFPI,AEOF,GFPK,GDgBU,AGdA,GHcG,GChBtB,MAAS,ADgBF,CChBG,IAAD,EAA4B,IAA5B,CDgBa,CChBwC,EDgBxC;AChB6C,ADgB9B,AGRvC,IAAA,KFRqE,ADgB9B,AGRlC,EAAE,OHQgC,CChB+B,GAAD,EAAY;ACLrF,ADK0F,ADgBtC,AGP9C,CHOC,GErBP,ECcM,KFToF,EAAE,CES9E,CDdd,CDK+F,AES/E,CAAC,CDdjB,EDKmG,IAAT,AES1E,CDdhB,ADK0F,CCL1F,aAAA,CAAA;ADKwG,AEQ7F,GFR8D,EEEhD;ADLzB,ADGwG,ADgB3F,AGLT,CFXJ,GCHA,ACcI,GHKS,CAAA,KGLA,EDdb,ACce,GDdf,EFmBa,GAAY,EEnBzB,CAAA,ACce,CAAA,QHKF,IEnBb,CAAA,CCce;AATU,GAAvB;ADHF,ADEA,AFMA,ACUO,AGJL,EAAA,EDdI,ADEA,AFMA,ACUO,OChBA,EEYX,CDdc,ADEA,AEYd,GDdiB,AHQA,CCUQ,EDVU,CCUP,EChBxB,CEYJ,CAAW,CDdP,GHQA,CENU,ADgBH,CChBI,CEYf,EFZc,ECFG,ADES,CCFR,KAAD,AHQkB,CAAC,CGRC,AFkBT,CAAC,EDVM,EAAO,ACUd,EAAmB,GDVZ,EAAY;AENhB,AFMkB,ACWjD,AGHA,EHGA,AGHA,IJRiD,GENlB,GAAG,CAAC,ADiBxB,AGHX,CJRiD,AIQjD,EHGc,CDXmC,EAAA,CCWjD,GCjB+B,CAAe,IAAf,CAAA,AEc/B,CAAgB,OAAhB;AFdmD,ADkBpD,AGFC,CFhBF,ADgBO,CGAL,WAAA,CAAA,YAAA,CAAa,EAAb;ADjBA,ACmBA,EAAA,IDnBI,CAAC,AHO4C,IAAA,CGPjD,CHOiD,CGPrC,EHOqC,GAAA,EAAA,AIY9B,CAAC,EJZ6B,SAAA,CAAA,AIY7B,CAAA,OJZ6B,CIY9B,CJZ8B,AIYjD,IJZ4D;AGL5D,ADCF,AFImD,ACUtC,AGGZ,CAnBD,GFEM,AFI6C,EGL3C,CFeK,CAAA,IDVsC,CEJpC,AFIoC,EGLlC,AHKkC,CEJjC,ECDD,AHKkC,CGLlC,AHKkC,CAAA,CGLlC,CFeJ,CDVsC,CGL/B,CDCd,ADcqB,IEfF,CAAC,EHKyB,CAAA,CEJjC,CAAC,AFIgC,CGLlC,AHKkC,GCUtC,CCdK,ECDc,ADCD,ICDd,IAAe,EAAA,KAAA,KAAA,CAAf,GAAe,KAAA,CAAf,GAAe,EAAA,CAAE,GAAhC;ADEA,MAAI,GAAJ;ACAA,AFgBK,AGEE,IHFI,EEhBP,CCkBG,CAAA,GDlBE,CAAC,ECkBH,GAAA,CHFkB,GEhBrB,AFgBwB,EGErB,GDlBiB,IFgBb,OEhBP,IAAmC,CAAC,CAAC,CFgBb,GAAA,CEhBkB,CAAC,GAA/C,EAAoD;AAClD,ADCF,AFEA,ACYgD,IEf9C,EDCE,GFEG,ACYyC,ECdvC,CAAC,CCDC,GDCP,ECDO,EFeqC,CCd7B,CCDjB,IAAA,SAAS,CDCQ,CAAA,GCDR,KAAA,CAAT,GAAS,KAAA,CAAT,EDCF,CCDE,CDCuC,QCD9B,CAAE,WAAX,CAAuB,KAAK,CAAC,GAA7B,CAAA;AACD,ADCC,AFEA,ACWyD,CAAtD,EEhBL,CDGE,AFEA,GEFG,CFEC,CGHC,CDCC,AFEF,GGHK,CHEJ,IGFS,ADCA,CCDC,ADCA,SCDN,KAAoB,ADCvB,CAAwB,KAAK,CAAC,GCD3B,EDCqB,CAAY,CCDC,CAAC,CAAC,KAAK,CAAC,ADC7C,CAAN,ECDK,EAAmD;AACxD,ADCD,AFEC,GEJF,CCCE,AHGA,KEFK,AFEA,EAAA,EGHI,KAAA,CHGJ,CAAA,EGHL,IAAA,EHGK,CAAA,EAAA,EACA,EGJI,GHGJ,CAAA,CGHI,CHIC,IGJD,CAAT,GAAS,KAAA,CAAT,GAAA,SAAS,CAAE,WAAX,CAAuB,KAAK,CAAC,GAA7B,CAAA;AACD,ADCC,AFGE,ACQO,GEdJ,GHMH,CCQO,CCXH,ADWG,CEZJ,IAAI,CHIC,EAAE,EGJE,ADCA,CCDC,EDCG,CDWT,ECXY,AFGD,CAAC,ACQE,ECXC,CCDf,AHIG,CAAa,IGJI,EDCG,CAAC,GFGP,ACQjB,EEZA,GHIgB,CGJgB,CAAC,AHIX,CGJY,EDCnB,CAAuB,ECDC,CAAC,EDCG,CCD/C,ADCgD,ECDC,EDC9B,CAAxB;ACAA,ADEA,AFEI,IGJJ,ADEA,MAAM,CAAC,ICFP,ADEA,AFEW,CGJX,ADEY,KAAK,CAAC,CFEA,EGJlB,CACE,CDCF,CFEW,CEDR,ECFI,CAAC,EHGoB,CGJ5B,ADEA,CACU,CCFC,CAAA,EAAA,EHGA,CGFT,EHEqC,CEFvC,ECAO,ADEJ,CCFK,CHEG,GAAoC,EEF/C,CAEW,ECHA,MACM,EDEL,ECHD,EDGA,AFAqD,CAAC,CGFhD,ADED,ECFC,EHE+C,CAA5D,EGFa,KAAA,CADN,GACM,KAAA,CADN,GACM,EAAA,CAAE,KAFnB,EAGE,KAAK,CAAC,KAHR;AAKD,ADDsB,AFClB,ACOA,IAAM,GDTG,MECS,MDQG,GAAG,CCRE,CAAC,ODQrB,KCRY,CAAsB,IAAtB,EAA4B,GDQtB,CAAC,CCR0B,CAAC,KAAN,CAAY,ADQlC,EAAuB,ECRD,CAA5B,CAAA;AAA8C,AFFzD,ACWZ,EAAA,GCXE,AFDK,SCYK,GAAG,QAAf;AENA,ADFC,AFNM,ACeR,CAFM,CELL,CHRA,SGQU,CAAC,KAAK,CAAC,KAAP,CAAV;AACA,AHAD,CAVD,CGUE,UAAU,CAAC,KAAK,CAAC,OAAP,CAAV;AACD,ADFC,ADKW,CEtBb,MFsBa,CAAA,CCLJ,GAAP,WDKW,GAAe,eAAf;ACJZ,AFaQ,CE3BT,MF2BS,CAAA,aAAA,GAAA,aAAA;AGVT,AHDa,ACKN,IEJD,AFIO,GDLA,CAAA,MGCG,GAAG,EFIS,GAAG,IEJzB,EHDO,GAAuB,ACKvB,KEJM,GAAA,MHDN,CCKkB,GAAA;AEH7B,ADsCO,ADnC0C,OCmC1C,CAAA,CDnC0C,QCmC1C,GAAA,CDnC0C,QCmC1C;ACrCP,AHFF,ACI+D,CAAxD,CEFL,EHFI,SGEJ,CAAA,OHFqB,GAAG,EGExB,GAAe,IHFX,GGEJ,CAAuB,UAAvB,GHFwB,CAAC,IAAD,EAAkB;AGG1C,ADJF,AFEE,EGEA,EDJI,KCIG,AHFA,CGEC,GAAR,ADJa,CCID,EDJI,QCIhB,CDJI,CCIoB,QDJR,CAAC,ECIO,CAAA,ADJR,EAA0B,SAA1B,CCIQ,CDJ8C,CCItE,QDJgB,EAAgF;ACMhG,ADLA,AFEE,ACES,IDFT,EGGI,ADLF,CAAC,ADIM,CDFL,ACEK,EDFH,GGGK,GAAG,ADLZ,CFEI,CAAA,EEFU,CAAC,EDIR,GAAe,CECV,CAAA,EDLhB,EAA8B,MCKd,AHJT,CEFyF,CCMhG,ADHA,CDEW;AEEX,AHHE,IAAA,EGGE,CAAC,EHHE,EAAE,GGGT,EAAc;AACd,ADJA,AFCI,ACCC,ECFL,EDEW,EEEP,AHHA,CGGC,CDJC,CAAC,IAAP,CCIY,ADJA,ADES,CEER,AHHA,EAAE,ACCS,GEExB,CHJS,CGIW,CDJpB,EACG,CDCQ,KCFX,CACU,IDCc,CAAC,ECFzB,EAEG,ADAqB,EAAmB,ICF3C,CAEU,UAAA,GAAA,EAAG;ACIb,ADJiB,AFAb,ACCJ,EEGA,AFHA,IDDI,GCCG,ECDU,CCIP,AFHA,CEGC,ADJQ,CFAP,EEAU,AFAR,ACCd,IEGkB,ADJQ,KCIR,IAAP,ADJM,ICIN,CDJ6B,KAAK,CCI3B,ADJ4B,KCI5B,IDJ2B,CCI3B,CAAP,ADJ8C,GCIvC,KAAA,CAAP,ADJkC,CAAL,CAA4B,CCIzD,EDJ6B,CAAvB,ICIC,CAAE,KAAV,CAAV;AACA,ADLwE,AFF/D,ACIV,CAFM,CEKL,CDPA,EAGG,OAHH,CCOA,ADJW,CCIX,SDJW,IAAA,CCIX,CAAe,ADJA,OCIf;AACA,ADJI,AFNG,EGUP,CHVA,KEMU,KCIV,CAAA,GDJmB,GAAI,ICIvB,ADJ2B,CCIhB,ADJiB,ICI5B,ODJuB,GAAmB,MAAnB,CAA0B,CAA1B,CAAnB;ACKL,ADJK,AFAL,ACHY,CELb,AHAA,GEQM,GAAG,ADHI,CCGH,ADHG,UAAA,GAAU,MCGjB,CAAwB,GDHjB,MCGP,EAAmC,SAAS,CAAC,IAAD,CAA5C;AACD,GANH,EAJgG,CAWhG;ACIF,AHJwB,ACFjB,IEMH,AFNS,CEMR,EHJmB,CAAA,GGIb,CAAC,EFNW,GAAG,QDEF,CCFX,EDEW,GGIxB,EAAiC,GFNP,GAAA,MDEF;AGKtB,ADJA,ADH4C,EEO5C,ADJA,MCIM,ADJA,CCIC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","file":"first.e31bb0bc.js","sourceRoot":"..","sourcesContent":["export type ElementType = string\nexport type ElementProps = Record<string, any>\nexport type Element = {\n  type: ElementType\n  props: ElementProps & { children: Element[] }\n}\nexport type PrimaryType = string | number\nexport type CreateElement = (\n  type: string,\n  props: ElementProps | null,\n  ...children: (Element | PrimaryType)[]\n) => Element\nconst createElement: CreateElement = (type, props, ...children) => {\n  return {\n    type,\n    props: {\n      ...props,\n      children: children.map((child) => {\n        return typeof child === 'object' ? child : createTextElement(child)\n      }),\n    },\n  }\n}\n\nexport const TEXT_ELEMENT_LITERAL = \"TEXT_ELEMENT\"\nconst createTextElement = (text: PrimaryType): Element => {\n  return {\n    type: TEXT_ELEMENT_LITERAL,\n    props: {\n      nodeValue: text,\n      children: [],\n    },\n  }\n}\n\nexport { createElement, createTextElement }\n","import type { Element } from './createElement'\n\nexport type Fiber = {\n  parent: Fiber | null\n  child: Fiber | null\n  sibling: Fiber | null\n  dom: HTMLElement | Text | null\n  alternate?: Fiber | null\n  effectTag?: \"UPDATE\" | \"DELETION\" | \"PLACEMENT\"\n} & Element\n\n// next fiber\nlet nextUnitWork: Fiber | null = null\n// root fiber\nlet wipRoot: Fiber | null = null\nlet currentRoot: Fiber | null = null\nlet deletions: Fiber[] = []\n\nexport const setDeletions = (fibers: Fiber[]): void => {\n  deletions = fibers\n}\nexport const getDeletions = (): Fiber[] => deletions\nexport const setCurrentRoot = (root: Fiber | null): void => {\n  currentRoot = root\n}\nexport const getCurrentRoot = (): Fiber | null => currentRoot\nexport const setNextUnitWork = (unitWork: Fiber | null): void => {\n  nextUnitWork = unitWork\n}\nexport const getNextUnitWork = (): Fiber | null => nextUnitWork\nexport const setWipRoot = (root: Fiber | null): void => {\n  wipRoot = root\n}\nexport const getWipRoot = (): Fiber | null => wipRoot","import type { Fiber } from './fiberMeta'\nimport { TEXT_ELEMENT_LITERAL } from './createElement'\n\nconst isProperty = (key: string) => key !== 'children' && !isEvent(key)\nconst isNew = (prev: Record<string, any>, next: Record<string, any>) => (key: string) => prev[key] !== next[key]\nconst isGone = (prev: Record<string, any>, next: Record<string, any>) => (key: string) => !(key in next)\nconst isEvent = (key: string) => key.startsWith(\"on\")\n\nconst createDOM = (fiber: Fiber): HTMLElement | Text => {\n  let dom: HTMLElement | Text\n\n  if (fiber.type === TEXT_ELEMENT_LITERAL) {\n    dom = document.createTextNode(fiber.props.nodeValue)\n  } else {\n    const innerDom = (dom = document.createElement(fiber.type))\n\n    Object.keys(fiber.props)\n      .filter(isProperty)\n      .forEach((name) => innerDom.setAttribute(name, fiber.props[name]))\n  }\n\n  return dom\n}\n\nconst updateDOM = (dom: HTMLElement | Text, prevProps?: Fiber['props'], nextProps?: Fiber['props']): void => {\n  if (!prevProps || !nextProps) return;\n  \n  // remove old or changed event listeners\n  Object.keys(prevProps)\n    .filter(isEvent)\n    .filter(key => !(key in nextProps) || isNew(prevProps, nextProps)(key))\n    .forEach(name => {\n      const eventType  = name.toLowerCase().substr(2)\n      dom.removeEventListener(eventType, prevProps[name])\n    })\n  // add event listeners\n  Object.keys(nextProps)\n    .filter(isEvent)\n    .filter(isNew(prevProps, nextProps))\n    .forEach(name => {\n      const eventType = name\n        .toLowerCase()\n        .substring(2)\n      dom.addEventListener(\n        eventType,\n        nextProps[name]\n      )\n    })\n\n  // remove old properties\n  Object.keys(prevProps)\n    .filter(isProperty)\n    .filter(isGone(prevProps, nextProps))\n    .forEach(name => dom[name] = \"\")\n\n  // set new or changed properties\n  Object.keys(nextProps)\n    .filter(isProperty)\n    .filter(isNew(prevProps, nextProps))\n    .forEach((name) => {\n      dom[name] = nextProps[name]\n    })\n}\n\nexport { createDOM, updateDOM }\n","import { createDOM, updateDOM } from './createDOM'\nimport type { Element } from './createElement'\nimport { Fiber, getDeletions, getNextUnitWork, getWipRoot, setCurrentRoot, setDeletions, setNextUnitWork, setWipRoot } from \"./fiberMeta\"\n\nconst commitWork = (fiber: Fiber | null) => {\n  if (!fiber) return\n\n  const domParent = fiber.parent?.dom\n\n  if (fiber.effectTag === \"PLACEMENT\" && !!fiber.dom) {\n    domParent?.appendChild(fiber.dom as HTMLElement | Text)\n  } else if (fiber.effectTag === \"DELETION\" && !!fiber.dom) {\n    domParent?.removeChild(fiber.dom)\n  } else if (fiber.effectTag === \"UPDATE\" && !!fiber.dom) {\n    updateDOM(\n      fiber.dom,\n      fiber.alternate?.props,\n      fiber.props\n    )\n  }\n\n  commitWork(fiber.child)\n  commitWork(fiber.sibling)\n}\n\nconst commitRoot = () => {\n  // add nodes to dom\n  getDeletions().forEach(commitWork)\n  console.log(\"deletion\", getDeletions())\n\n  const wipRoot = getWipRoot()\n  if (!wipRoot) return\n  if (!wipRoot.child) return\n\n  commitWork(wipRoot?.child)\n  setCurrentRoot(wipRoot)\n  setWipRoot(null)\n}\n\nif (!window.requestIdleCallback) {\n  window.requestIdleCallback = (callback) => {\n    callback({\n      timeRemaining: () => Infinity,\n      didTimeout: false,\n    })\n    // fake handle\n    return -1\n  }\n}\n\nexport const workLoop = (deadline: IdleDeadline): void => {\n  let shouldYield = false\n  while (getNextUnitWork() && !shouldYield) {\n    const unitWork = getNextUnitWork()\n    if (!unitWork) break\n    setNextUnitWork(performUnitOfWork(unitWork))\n    shouldYield = deadline.timeRemaining() < 1\n  }\n\n\n  if (!getNextUnitWork() && getWipRoot()) {\n    commitRoot()\n    return\n  }\n  requestIdleCallback(workLoop)\n}\n\n// react 内部已经不再使用 requestIdleCallback API， 使用了 scheduler package\n// requestIdleCallback(workLoop)\n\nconst performUnitOfWork = (fiber: Fiber): Fiber | null => {\n  console.log(\"fiber\", fiber)\n  // add dom node\n  if (!fiber.dom) {\n    fiber.dom = createDOM(fiber)\n  }\n\n  // 可能会看到残缺的 ui。 需要去监听 根 fiber,\n  // if (fiber.parent) {\n  //   fiber.parent.dom?.appendChild(fiber.dom)\n  // }\n\n  // create new fibers\n  const elements = fiber.props.children\n  reconcileChildren(fiber, elements)\n\n  // return next unit of work\n\n  if (fiber.child) return fiber.child\n\n  let nextFiber = fiber\n  while (nextFiber) {\n    if (nextFiber.sibling) {\n      return nextFiber.sibling\n    }\n    nextFiber = nextFiber.parent as Fiber\n  }\n\n  return nextFiber\n}\n\nfunction reconcileChildren(wipFiber: Fiber, elements: Element[]) {\n  let index = 0\n  let oldFiber = wipFiber.alternate && wipFiber.alternate.child\n\n  let prevSibling: Fiber | null = null\n\n  while (index < elements.length || !!oldFiber) {\n    const element = elements[index]\n\n    let newFiber: Fiber | null = null\n\n    // compare old fiber to element\n    const sameType = oldFiber && element && oldFiber.type === element.type\n    if (oldFiber && element && oldFiber.type === element.type) {\n      // update the node\n      newFiber = {\n        type: oldFiber.type,\n        props: element.props,\n        dom: oldFiber.dom,\n        parent: wipFiber,\n        alternate: oldFiber,\n        effectTag: \"UPDATE\",\n        child: null,\n        sibling: null\n      }\n    } else {\n      if (element && !sameType) {\n        newFiber = {\n          type: element.type,\n          props: element.props,\n          dom: null,\n          parent: wipFiber,\n          alternate: null,\n          effectTag: \"PLACEMENT\",\n          child: null,\n          sibling: null\n        }\n      }\n      if (oldFiber && !sameType) {\n        // delete the old fiber node\n        oldFiber.effectTag = \"DELETION\"\n        setDeletions([...getDeletions(), oldFiber])\n      }\n    }\n\n\n    if (index === 0) {\n      wipFiber.child = newFiber\n    } else if (element) {\n      prevSibling && (prevSibling.sibling = newFiber)\n    }\n\n    prevSibling = newFiber\n    // set element to next\n    index++\n    // set fiber to next\n    if (oldFiber) {\n      oldFiber = oldFiber.sibling\n    }\n  }\n}\n","import type { Element } from './createElement'\nimport { Fiber, getCurrentRoot, setDeletions } from './fiberMeta'\nimport { setNextUnitWork, setWipRoot } from './fiberMeta'\nimport { workLoop } from './concurrent'\n\nexport type Render = (element: Element, containers: HTMLElement) => void\nconst render: Render = (element, containers) => {\n  const wipRoot: Fiber = {\n    dom: containers,\n    parent: null,\n    child: null,\n    sibling: null,\n    type: 'root',\n    props: {\n      children: [element],\n    },\n    alternate: getCurrentRoot()\n  }\n  setWipRoot(wipRoot)\n\n  setNextUnitWork(wipRoot)\n\n  setDeletions([])\n\n  requestIdleCallback(workLoop)\n}\n\nexport { render }\n","import { createElement } from './createElement'\nimport { render } from './render'\n\nconst Didact = {\n  createElement,\n  render,\n}\n\nexport default Didact\n","import Didact from \"../../src/index\"\n\nDidact.render(\n  <div>\n    <p>\n      <span>1</span>\n    </p>\n  </div>,\n  document.getElementById(\"root\")\n)\n\nsetTimeout(\n  () => {\n    Didact.render(\n      <div>\n        <p>\n          <span>3</span>\n        </p>\n        <span></span>\n      </div>,\n      document.getElementById(\"root\")\n    )\n  },\n  1000 * 5\n)\n\n"]}